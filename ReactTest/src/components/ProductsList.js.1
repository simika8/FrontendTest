import React, { Component, Fragment, useState, useEffect } from 'react';
import axios from 'axios';
import { LazyLoadImage } from 'react-lazy-load-image-component';
import './search.css';


class Product extends React.Component{
    constructor(props) {
        super(props);

        this.state= {
            imageSrc:'https://localhost:44339/api/Pictures?productId='+this.props.product.id+'&minTimeoutMs=100&maxTimeoutMs=3000',
            name: this.props.product.name,
        };
       
    }
    render() {
        return (
            <tr>
                <td>
                    <div className="pic150">
                        <img 
                            src={this.state.imageSrc} 
                            alt="szöveg"
                        />
                    </div>
                </td>
                <td>{this.props.product.name}</td>
                <td>{this.props.product.price}</td>
                <td>{this.props.product.stock}</td>
                <td>{this.props.product.description}</td>
            </tr>
        )
    }
}
export default class TodosList extends React.Component {

    constructor(props) {
        super(props);
        this.state = {
            products: [], 
            searchfilter: ''
        };

    }
    
    componentDidMount() {
        this.refilter(this.state.searchfilter);
    }

    refilter(searchfilter){
        //axios.get('https://localhost:44339/api/Sales?productId=3fa85f64-5717-4562-b3fc-2c963f66afa6&minTimeoutMs=0&maxTimeoutMs=0')

        this.setState({searchfilter: searchfilter});  

        if (searchfilter) {
            axios.get('https://localhost:44339/api/Products?keyword='+searchfilter+'&take=10&minTimeoutMs=0&maxTimeoutMs=0')
            .then(response => {
                if (response.data.keyword === this.state.searchfilter){
                    this.setState({ products: response.data.data });
                }
            })
            .catch(function (error){
                console.log(error);
            });
        } else {
            this.setState({ products: [] });
        }
    }
    

    productList() {
        return this.state.products.map(function(currentProduct, i){
            return <Product product={currentProduct} key={currentProduct.id} />;
        })
    }

    handleChange = (event) => {

        
        this.refilter(event.target.value);
    }

    render() {
        return (
            <div>
                <h3>Products List s:{this.state.searchfilter}</h3>
                <input className="search" maxLength="15" placeholder="Keresés" value={this.state.searchfilter} onChange={this.handleChange} />
                <table className="table table-striped" style={{ marginTop: 20 }} >
                    <thead>
                        <tr>
                            <th>Kép</th>
                            <th>Név</th>
                            <th>Ár</th>
                            <th>Készlet</th>
                            <th>Leírás</th>
                        </tr>
                    </thead>
                    <tbody>
                        { this.productList() }
                    </tbody>
                </table>
            </div>
        )
    }
}